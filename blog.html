<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>博客阅读</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js/styles/github.min.css">

  <style>
    html, body { margin: 0; padding: 0; overflow: hidden; font-family: sans-serif; }
    nav { position: fixed; top: 0; left: 0; height: 3rem; width: 100%; background: #fff; display: flex; align-items: center; padding: 0 1rem; border-bottom: 1px solid #ddd; z-index: 1000; }
    nav a { margin-right: 1.5rem; text-decoration: none; color: #000; display: flex; align-items: center; }
    nav span { margin-left: 0.3rem; }
    main { display: flex; height: calc(100vh - 3rem); margin-top: 3rem; overflow: hidden; }
    .sidebar-left, .sidebar-right { padding: 1rem; overflow-y: auto; scrollbar-width: none; }
    .sidebar-left::-webkit-scrollbar, .sidebar-right::-webkit-scrollbar, main::-webkit-scrollbar { display: none; }
    .sidebar-left { width: 260px; border-right: 1px solid #eee; }
    .sidebar-right { width: 260px; border-left: 1px solid #eee; }
    .content { flex: 1; overflow-y: auto; padding: 2rem; word-break: break-word; }
    .markdown-body { max-width: 100%; }
    @media (max-width: 1024px) {
      .sidebar-right { display: none; }
      .content { padding-right: 1rem; }
    }
    @media (max-width: 768px) {
      main { flex-direction: column; }
      .sidebar-left, .sidebar-right { width: 100%; height: auto; display: none; border: none; background: #f8f8f8; position: absolute; z-index: 999; top: 3rem; left: 0; }
      .sidebar-left.active { display: block; animation: fadein 0.3s; }
      #toggle-toc { position: fixed; top: 50%; left: 0; transform: translateY(-50%); background: #007bff; color: #fff; padding: 0.5rem; border-radius: 0 5px 5px 0; z-index: 1001; cursor: pointer; }
    }
    @keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body>

  <nav>
    <a href="index.html">🏠<span>主页</span></a>
    <a href="blog.html">📘<span>博客</span></a>
    <a href="other.html">📚<span>其他</span></a>
    <a href="about.html">👤<span>关于</span></a>
  </nav>

  <div id="toggle-toc">📑</div>

  <main>
    <div class="sidebar-left" id="toc"></div>
    <div class="content">
      <article class="markdown-body" id="content">加载中...</article>
      <div class="sidebar-right" id="archive">
        <h3>归档</h3>
        <ul>
          <li>2025-07</li>
          <li>2025-06</li>
        </ul>
      </div>
    </div>
  </main>

  <!-- markdown-it 主体 -->
<script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-anchor@8.6.7/dist/markdownItAnchor.umd.min.js"></script>

<!-- KaTeX 数学公式 -->
<script src="https://cdn.jsdelivr.net/npm/markdown-it-katex@3.0.1/dist/markdown-it-katex.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />

<!-- Mermaid 图表 -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
<!-- Highlight.js 代码高亮 -->
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css" />

<!-- TOC 插件（tocbot） -->
<script src="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.js"></script>


  <script>
    const md = window.markdownit({
  html: true,
  linkify: true,
  typographer: true,
  highlight: str => hljs.highlightAuto(str).value
}).use(window.markdownItAnchor)
  .use(window.markdownitKatex);

const file = new URLSearchParams(location.search).get('p') || 'readme.md';

fetch('p/' + file)
  .then(res => res.text())
  .then(text => {
    const html = md.render(text);
    document.getElementById('content').innerHTML = html;

    // 初始化 TOC
    tocbot.init({
      tocSelector: '#toc',
      contentSelector: '#content',
      headingSelector: 'h1, h2, h3',
      collapseDepth: 6
    });

    // 初始化 Mermaid（必须在内容渲染后）
    if (typeof mermaid !== 'undefined') {
      mermaid.initialize({ startOnLoad: false });
      mermaid.run();
    }
  })
  .catch(err => {
    document.getElementById('content').innerText = '加载失败：' + err;
  });

  </script>
</body>
</html>
