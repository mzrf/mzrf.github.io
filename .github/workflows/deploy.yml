name: Get Latest Commit Changed Files

on:
  push:
    branches:
      - master

jobs:
  detect_changes:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 2  # ç¡®ä¿èŽ·å–è‡³å°‘ä¸¤ä¸ª commit ä»¥ä¾¿ diff

      - name: Get added, modified, and deleted files
        id: file_changes
        run: |
          echo "ðŸ” Detecting file changes in latest commit..."

          added=$(git diff-tree --no-commit-id --diff-filter=A --name-only -r HEAD)
          modified=$(git diff-tree --no-commit-id --diff-filter=M --name-only -r HEAD)
          deleted=$(git diff-tree --no-commit-id --diff-filter=D --name-only -r HEAD)

          echo "added=$added" >> $GITHUB_OUTPUT
          echo "modified=$modified" >> $GITHUB_OUTPUT
          echo "deleted=$deleted" >> $GITHUB_OUTPUT

      - name: Debug output of changed files
        run: |
          echo "ðŸŸ© Added files:"
          echo "${{ steps.file_changes.outputs.added }}"

          echo "ðŸŸ¨ Modified files:"
          echo "${{ steps.file_changes.outputs.modified }}"

          echo "ðŸŸ¥ Deleted files:"
          echo "${{ steps.file_changes.outputs.deleted }}"
